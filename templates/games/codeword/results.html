{% extends 'base.html' %}

{% block title %}Code Word Results{% endblock %}

{% block content %}
<section class="py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card p-4 text-center">
                    <div style="font-size: 4rem;" class="mb-3">
                        {% if attempt.is_won %}ðŸŽ‰{% else %}ðŸ˜¢{% endif %}
                    </div>

                    <h3 class="fw-bold mb-2">
                        {% if attempt.is_won %}
                        Excellent!
                        {% else %}
                        Better luck next time!
                        {% endif %}
                    </h3>

                    <p class="text-muted mb-4">
                        {% if attempt.is_won %}
                        You got it in {{ attempt.attempts_used }}/6 tries!
                        {% else %}
                        The word was <strong>{{ daily_word.word.word }}</strong>
                        {% endif %}
                    </p>

                    <!-- Guess Preview -->
                    <div class="mb-4">
                        {% for guess in attempt.guesses %}
                        <div class="d-flex justify-content-center gap-1 mb-1">
                            {% for state in guess.result %}
                            <div style="width: 30px; height: 30px; border-radius: 4px;"
                                 class="{% if state == 'correct' %}bg-success{% elif state == 'present' %}bg-warning{% else %}bg-secondary{% endif %}">
                            </div>
                            {% endfor %}
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Stats -->
                    <div class="row text-center mb-4">
                        <div class="col-4">
                            <div class="h4 fw-bold mb-0">{{ streak.total_games }}</div>
                            <small class="text-muted">Played</small>
                        </div>
                        <div class="col-4">
                            <div class="h4 fw-bold mb-0">
                                {% widthratio streak.total_wins streak.total_games 100 %}%
                            </div>
                            <small class="text-muted">Win Rate</small>
                        </div>
                        <div class="col-4">
                            <div class="h4 fw-bold mb-0">{{ streak.current_streak }}</div>
                            <small class="text-muted">Streak</small>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="d-flex gap-2 justify-content-center flex-wrap">
                        <button class="btn btn-primary" onclick="shareResult()">
                            <i class="bi bi-share me-1"></i> Share Result
                        </button>
                    </div>

                    <hr class="my-4">

                    <p class="text-muted small mb-0">
                        Come back tomorrow for a new word!
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
function shareResult() {
    const shareText = `{{ share_text|escapejs }}`;

    if (navigator.share) {
        navigator.share({ text: shareText });
    } else {
        navigator.clipboard.writeText(shareText).then(() => {
            alert('Copied to clipboard!');
        });
    }
}
</script>
{% endblock %}
