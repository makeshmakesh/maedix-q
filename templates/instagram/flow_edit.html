{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Automation: {{ flow.title }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/flow_edit.css' %}?v=3">

<section class="py-3 py-md-4">
    <div class="container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <!-- Mobile: single row with title + switch button (same pattern as wizard header) -->
            <div class="d-flex d-md-none justify-content-between align-items-center mb-2">
                <div class="d-flex align-items-center gap-2 min-width-0">
                    <a href="{% url 'flow_list' %}" class="wizard-back-btn" title="Back to flows" style="background:rgba(255,255,255,0.15); color:white; width:32px; height:32px; border-radius:8px; display:flex; align-items:center; justify-content:center; text-decoration:none; flex-shrink:0;">
                        <i class="bi bi-arrow-left"></i>
                    </a>
                    <h1 class="text-truncate" style="font-size:1rem; font-weight:700; margin:0;">{{ flow.title }}</h1>
                </div>
                <button class="wizard-mode-btn" id="mobileSwitchEditorBtn" title="Change editor"
                        onclick="if(typeof showEditorChoiceModal==='function')showEditorChoiceModal(false)">
                    <i class="bi bi-sliders me-1"></i>Change Editor
                </button>
            </div>

            <!-- Desktop: original layout -->
            <div class="d-none d-md-flex flex-md-row justify-content-between align-items-start gap-3">
                <div class="flex-grow-1 min-width-0">
                    <a href="{% url 'flow_list' %}" class="back-link">
                        <i class="bi bi-arrow-left"></i> Back to Automations
                    </a>
                    <h1 class="text-truncate">
                        <i class="bi bi-diagram-3 me-2"></i>{{ flow.title }}
                    </h1>
                    <div class="flow-meta">
                        <span>
                            {% if flow.is_active %}
                            <i class="bi bi-check-circle-fill"></i> Active
                            {% else %}
                            <i class="bi bi-pause-circle"></i> Paused
                            {% endif %}
                        </span>
                        <span>
                            <i class="bi bi-lightning-charge"></i>
                            {% if flow.trigger_type == 'comment_any' %}Any comment{% else %}Keywords{% endif %}
                        </span>
                        <span>
                            <i class="bi bi-signpost-split"></i> {{ flow.nodes.count }} steps
                        </span>
                    </div>
                </div>
                <div class="header-actions flex-shrink-0">
                    <!-- Help Link -->
                    <a href="{% url 'flow_builder_help' %}" class="btn-mode-toggle" title="Learn about node types and how to build flows" target="_blank">
                        <i class="bi bi-question-circle me-1"></i><span class="d-none d-sm-inline">Help</span>
                    </a>
                    <!-- Mode Toggle (desktop) -->
                    <div class="btn-group" role="group" id="editorModeToggle">
                        <a href="{% url 'flow_edit_wizard' flow.pk %}" class="btn-mode-toggle" title="Easy guided editor">
                            <i class="bi bi-magic me-1"></i><span>Easy</span>
                        </a>
                        <button type="button" class="btn-mode-toggle active" data-mode="visual" title="Visual drag-and-drop editor">
                            <i class="bi bi-diagram-3 me-1"></i><span>Visual</span>
                        </button>
                        <button type="button" class="btn-mode-toggle" data-mode="form" title="Form-based editor (mobile friendly)">
                            <i class="bi bi-list-ul me-1"></i><span>Form</span>
                        </button>
                    </div>
                    <button class="btn-mode-toggle" id="resetViewBtn" title="Reset canvas view">
                        <i class="bi bi-arrows-fullscreen"></i>
                    </button>
                    <button class="btn-save-flow" id="saveFlowBtn">
                        <i class="bi bi-check-lg"></i>
                        <span>Save</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Visual Editor -->
        <div class="row" id="visualEditor">
            <!-- Node Palette (Left) -->
            <div class="col-md-2 left-panel-col" id="leftPanelCol">
                <div class="node-palette" style="position: relative;">
                    <button class="panel-toggle-btn panel-toggle-left" id="toggleLeftPanel" title="Collapse panel">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <h6 class="mb-3"><i class="bi bi-grid-3x3-gap me-2"></i>Add Steps</h6>

                    <small class="text-muted d-block mb-2">ðŸ’¬ Messages</small>
                    <div class="palette-item" draggable="true" data-node="comment_reply">
                        <i class="bi bi-chat-dots text-info"></i>
                        <span>Reply to Comment</span>
                    </div>

                    <div class="palette-item" draggable="true" data-node="message_text">
                        <i class="bi bi-chat-left-text text-primary"></i>
                        <span>Send Message</span>
                    </div>

                    <div class="palette-item" draggable="true" data-node="message_link">
                        <i class="bi bi-link text-warning"></i>
                        <span>Send Link</span>
                    </div>

                    {% if features.quick_replies %}
                    <small class="text-muted d-block mb-2 mt-3">ðŸ”˜ Interactive</small>
                    <div class="palette-item" draggable="true" data-node="message_quick_reply">
                        <i class="bi bi-ui-radios-grid text-success"></i>
                        <span>Quick Reply</span>
                    </div>

                    <div class="palette-item" draggable="true" data-node="message_button_template">
                        <i class="bi bi-menu-button-wide text-purple"></i>
                        <span>Message + Buttons</span>
                    </div>
                    {% else %}
                    <div class="palette-item disabled" title="Upgrade to Pro">
                        <i class="bi bi-lock text-muted"></i>
                        <span class="text-muted">Quick Reply</span>
                    </div>
                    {% endif %}

                    <small class="text-muted d-block mb-2 mt-3">ðŸ”€ Conditions</small>
                    {% if features.follower_check %}
                    <div class="palette-item disabled" draggable="false" data-node="condition_follower" title="Add a Quick Reply or Button Template first">
                        <i class="bi bi-person-check text-danger"></i>
                        <span>Check if Follower</span>
                        <small class="d-block text-muted" style="font-size:10px;">Needs buttons first</small>
                    </div>
                    {% else %}
                    <div class="palette-item disabled" title="Upgrade to Creator">
                        <i class="bi bi-lock text-muted"></i>
                        <span class="text-muted">Check if Follower</span>
                    </div>
                    {% endif %}

                    <div class="palette-item" draggable="true" data-node="condition_user_interacted">
                        <i class="bi bi-person-lines-fill" style="color: #5a2d82;"></i>
                        <span>Check if Returning</span>
                    </div>

                    <small class="text-muted d-block mb-2 mt-3">âœ¨ Advanced</small>
                    <div class="palette-item" draggable="true" data-node="collect_data">
                        <i class="bi bi-input-cursor-text text-orange"></i>
                        <span>Collect Info</span>
                    </div>

                    {% if features.ai_social_agent %}
                    <div class="palette-item" draggable="true" data-node="ai_conversation">
                        <i class="bi bi-cpu" style="color: var(--primary);"></i>
                        <span>AI Chat</span>
                    </div>
                    {% else %}
                    <div class="palette-item disabled" title="Upgrade to access AI">
                        <i class="bi bi-cpu text-muted"></i>
                        <span class="text-muted">AI Chat</span>
                        <span class="badge bg-secondary ms-auto" style="font-size: 9px;">Upgrade</span>
                    </div>
                    {% endif %}
                </div>

                <!-- Flow Settings -->
                <div class="card mt-3">
                    <div class="card-header bg-light py-2 d-flex justify-content-between align-items-center"
                         data-bs-toggle="collapse" data-bs-target="#flowSettings" style="cursor: pointer;">
                        <h6 class="mb-0 small">
                            <i class="bi bi-gear me-1"></i>Flow Settings
                        </h6>
                        <div class="d-flex align-items-center gap-2">
                            {% if flow.is_active %}
                            <span class="badge bg-success">Active</span>
                            {% else %}
                            <span class="badge bg-secondary">Inactive</span>
                            {% endif %}
                            <i class="bi bi-chevron-down small"></i>
                        </div>
                    </div>
                    <div class="collapse" id="flowSettings">
                        <div class="card-body py-2">
                            <form method="post" id="flowSettingsForm">
                                {% csrf_token %}

                                <!-- Active Toggle -->
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" id="is_active" name="is_active"
                                           {% if flow.is_active %}checked{% endif %}>
                                    <label class="form-check-label small" for="is_active">Flow Active</label>
                                </div>

                                <!-- Title -->
                                <div class="mb-2">
                                    <label class="form-label small mb-1">Title</label>
                                    <input type="text" class="form-control form-control-sm" name="title"
                                           value="{{ flow.title }}" required maxlength="100">
                                </div>

                                <!-- Trigger Type -->
                                <div class="mb-2">
                                    <label class="form-label small mb-1">Trigger</label>
                                    <select class="form-select form-select-sm" name="trigger_type" id="settingsTriggerType">
                                        <option value="comment_keyword" {% if flow.trigger_type == 'comment_keyword' %}selected{% endif %}>
                                            Keyword Match
                                        </option>
                                        <option value="comment_any" {% if flow.trigger_type == 'comment_any' %}selected{% endif %}>
                                            Any Comment
                                        </option>
                                    </select>
                                </div>

                                <!-- Keywords -->
                                <div class="mb-2" id="settingsKeywordsSection">
                                    <label class="form-label small mb-1">Keywords</label>
                                    <input type="text" class="form-control form-control-sm" name="keywords"
                                           value="{{ flow.keywords }}" placeholder="link, free, send">
                                    <small class="text-muted" style="font-size: 11px;">Comma-separated</small>
                                </div>

                                <!-- Post Selection -->
                                <div class="mb-2">
                                    <label class="form-label small mb-1">Specific Post{% if not features.account_level_automation %} <span class="text-danger">*</span>{% endif %}</label>
                                    <div class="input-group input-group-sm">
                                        <input type="text" class="form-control" name="instagram_post_id" id="settingsPostId"
                                               value="{{ flow.instagram_post_id }}" placeholder="{% if features.account_level_automation %}All posts{% else %}Select a post (required){% endif %}" readonly>
                                        <button type="button" class="btn btn-outline-secondary" id="settingsBrowsePostsBtn">
                                            <i class="bi bi-image"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-danger" id="settingsClearPostBtn"
                                                style="{% if not flow.instagram_post_id %}display:none{% endif %}">
                                            <i class="bi bi-x"></i>
                                        </button>
                                    </div>
                                    {% if features.account_level_automation %}
                                    <small class="text-muted" style="font-size: 11px;">Leave empty for all posts</small>
                                    {% else %}
                                    <small class="text-danger" style="font-size: 11px;">Post required â€” <a href="{% url 'pricing' %}">upgrade</a> to apply on all posts</small>
                                    {% endif %}
                                </div>

                                <!-- Description -->
                                <div class="mb-2">
                                    <label class="form-label small mb-1">Description</label>
                                    <textarea class="form-control form-control-sm" name="description" rows="2"
                                              placeholder="Optional">{{ flow.description }}</textarea>
                                </div>

                                <button type="submit" class="btn btn-primary btn-sm w-100">
                                    <i class="bi bi-check me-1"></i>Save Settings
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Canvas (Center) -->
            <div class="col-md-8 center-panel-col" id="centerPanelCol">
                <div style="position: relative;">
                    <div id="drawflow"></div>
                    <div class="help-hint" id="desktopHint">
                        <i class="bi bi-info-circle me-1"></i>
                        Drag to pan â€¢ Scroll to zoom â€¢ Arrow keys to navigate
                    </div>
                    <div class="help-hint mobile-hint" id="mobileHint" style="display:none;">
                        <i class="bi bi-info-circle me-1"></i>
                        2-finger drag to pan â€¢ Pinch to zoom â€¢ Use buttons below
                    </div>
                    <!-- Custom Scrollbars -->
                    <div class="canvas-scrollbar canvas-scrollbar-h" id="scrollbarH">
                        <div class="scrollbar-thumb scrollbar-thumb-h" id="scrollThumbH"></div>
                    </div>
                    <div class="canvas-scrollbar canvas-scrollbar-v" id="scrollbarV">
                        <div class="scrollbar-thumb scrollbar-thumb-v" id="scrollThumbV"></div>
                    </div>

                    <!-- Pan/Navigation Controls -->
                    <div class="pan-controls">
                        <button id="panUpBtn" title="Pan Up"><i class="bi bi-chevron-up"></i></button>
                        <div class="pan-row">
                            <button id="panLeftBtn" title="Pan Left"><i class="bi bi-chevron-left"></i></button>
                            <button id="panCenterBtn" title="Center View"><i class="bi bi-fullscreen"></i></button>
                            <button id="panRightBtn" title="Pan Right"><i class="bi bi-chevron-right"></i></button>
                        </div>
                        <button id="panDownBtn" title="Pan Down"><i class="bi bi-chevron-down"></i></button>
                    </div>

                    <!-- Zoom Controls -->
                    <div class="zoom-controls">
                        <button id="zoomOutBtn" title="Zoom Out"><i class="bi bi-dash"></i></button>
                        <button id="zoomResetBtn" title="Reset Zoom"><i class="bi bi-square"></i></button>
                        <button id="zoomInBtn" title="Zoom In"><i class="bi bi-plus"></i></button>
                        <button id="fitViewBtn" title="Fit All Nodes"><i class="bi bi-arrows-fullscreen"></i></button>
                    </div>
                </div>
            </div>

            <!-- Edit Panel (Right) -->
            <div class="col-md-2 right-panel-col" id="rightPanelCol">
                <div class="edit-panel" id="editPanel">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0" id="editPanelTitle">Edit Node</h6>
                        <button class="btn btn-sm btn-outline-danger" id="deleteNodeBtn" title="Delete Node">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                    <form id="nodeEditForm">
                        <input type="hidden" id="editNodeId" name="node_id">
                        <input type="hidden" id="editNodeType" name="node_type">

                        <div id="nodeConfigFields">
                            <!-- Dynamic fields will be inserted here -->
                        </div>

                        <button type="submit" class="btn btn-primary w-100 mt-3">
                            <i class="bi bi-check me-1"></i>Update Node
                        </button>
                    </form>
                </div>

                <div id="noSelectionPanel" class="edit-panel active">
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-cursor fs-1 mb-2 d-block"></i>
                        <p class="mb-2">Select a node to edit</p>
                        <small>Or drag a step from the left panel to add it to your flow</small>
                    </div>

                    <hr>

                    <h6 class="mb-2"><i class="bi bi-lightbulb me-2"></i>Tips</h6>
                    <ul class="small text-muted ps-3">
                        <li>Drag from output dots to input dots to connect nodes</li>
                        <li>Follower Check has 2 outputs: green for followers, red for non-followers</li>
                        <li>Quick Reply buttons each have their own output for branching</li>
                        <li>Click a node to edit its settings</li>
                    </ul>
                </div>
            </div>

            <!-- Floating Toggle Button (visible when left panel is collapsed) -->
            <button class="floating-toggle floating-toggle-left" id="floatingToggleLeft" title="Show nodes panel">
                <i class="bi bi-chevron-right"></i>
            </button>
        </div>

        <!-- Form Editor (Mobile Friendly) -->
        <div id="formEditor">
            <div class="row">
                <div class="col-12 col-md-10 col-lg-8 mx-auto">
                    <!-- Flow Settings Card -->
                    <div class="card mb-3 flow-settings-card">
                        <div class="card-header py-2 d-flex justify-content-between align-items-center"
                             data-bs-toggle="collapse" data-bs-target="#formFlowSettings" style="cursor: pointer;">
                            <div class="d-flex align-items-center gap-2">
                                <i class="bi bi-gear text-primary"></i>
                                <span class="fw-bold small">{{ flow.title }}</span>
                                {% if flow.is_active %}
                                <span class="badge bg-success" style="font-size: 10px;">Active</span>
                                {% else %}
                                <span class="badge bg-secondary" style="font-size: 10px;">Inactive</span>
                                {% endif %}
                            </div>
                            <span class="badge bg-primary bg-opacity-10 text-primary" style="font-size: 10px;">
                                <i class="bi bi-pencil me-1"></i>Edit Settings <i class="bi bi-chevron-down ms-1"></i>
                            </span>
                        </div>
                        <div class="collapse" id="formFlowSettings">
                            <div class="card-body py-2">
                                <form method="post">
                                    {% csrf_token %}

                                    <div class="row g-2">
                                        <!-- Active Toggle -->
                                        <div class="col-12">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="form_is_active" name="is_active"
                                                       {% if flow.is_active %}checked{% endif %}>
                                                <label class="form-check-label small" for="form_is_active">Flow Active</label>
                                            </div>
                                        </div>

                                        <!-- Title -->
                                        <div class="col-12">
                                            <input type="text" class="form-control form-control-sm" name="title"
                                                   value="{{ flow.title }}" required maxlength="100" placeholder="Flow name">
                                        </div>

                                        <!-- Trigger Type -->
                                        <div class="col-6">
                                            <select class="form-select form-select-sm" name="trigger_type" id="formTriggerType">
                                                <option value="comment_keyword" {% if flow.trigger_type == 'comment_keyword' %}selected{% endif %}>Keyword</option>
                                                <option value="comment_any" {% if flow.trigger_type == 'comment_any' %}selected{% endif %}>Any Comment</option>
                                            </select>
                                        </div>

                                        <!-- Keywords -->
                                        <div class="col-6" id="formKeywordsCol">
                                            <input type="text" class="form-control form-control-sm" name="keywords"
                                                   value="{{ flow.keywords }}" placeholder="Keywords">
                                        </div>

                                        <!-- Post Selection -->
                                        <div class="col-12">
                                            <div class="input-group input-group-sm">
                                                <input type="text" class="form-control" name="instagram_post_id" id="formPostId"
                                                       value="{{ flow.instagram_post_id }}" placeholder="{% if features.account_level_automation %}All posts (no specific post){% else %}Select a post (required){% endif %}" readonly>
                                                <button type="button" class="btn btn-outline-secondary" id="formBrowsePostsBtn">
                                                    <i class="bi bi-image"></i>
                                                </button>
                                                <button type="button" class="btn btn-outline-danger" id="formClearPostBtn"
                                                        style="{% if not flow.instagram_post_id %}display:none{% endif %}">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                            </div>
                                            {% if not features.account_level_automation %}
                                            <small class="text-danger" style="font-size: 11px;">Post required â€” <a href="{% url 'pricing' %}">upgrade</a> to apply on all posts</small>
                                            {% endif %}
                                        </div>

                                        <div class="col-12">
                                            <button type="submit" class="btn btn-primary btn-sm w-100">
                                                <i class="bi bi-check me-1"></i>Save Settings
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <!-- Quick Info -->
                        <div class="card-footer py-1 bg-light small text-muted">
                            <i class="bi bi-info-circle me-1"></i>
                            {% if flow.trigger_type == 'comment_any' %}
                                Triggers on any comment
                            {% else %}
                                Keywords: <code>{{ flow.keywords|default:"any" }}</code>
                            {% endif %}
                            {% if flow.instagram_post_id %}
                                | Specific post
                            {% endif %}
                        </div>
                    </div>

                    <!-- Trigger Indicator -->
                    <div class="card mb-2 border-warning">
                        <div class="card-body py-2 px-3 d-flex align-items-center gap-2">
                            <i class="bi bi-lightning-charge text-warning"></i>
                            <div class="flex-grow-1">
                                <div class="small fw-bold">Trigger</div>
                                <div class="text-muted" style="font-size: 11px;">Comment received</div>
                            </div>
                            <i class="bi bi-arrow-down text-muted"></i>
                        </div>
                    </div>

                    <!-- Nodes Container -->
                    <div id="formNodesContainer">
                        <!-- Nodes will be rendered here by JavaScript -->
                    </div>

                    <!-- Add Node Section -->
                    <div class="add-node-section">
                        <p class="text-muted mb-2">What should happen next?</p>
                        <div class="dropdown add-node-dropdown">
                            <button class="btn btn-primary dropdown-toggle" type="button" id="addNodeDropdown" data-bs-toggle="dropdown">
                                <i class="bi bi-plus-circle me-1"></i>Add Step
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="addNodeDropdown">
                                <li class="dropdown-header">ðŸ’¬ Send Messages</li>
                                <li><a class="dropdown-item" href="#" data-add-node="comment_reply">
                                    <i class="bi bi-chat-dots text-info"></i>Reply to Comment
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-add-node="message_text">
                                    <i class="bi bi-chat-left-text text-primary"></i>Send Message
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-add-node="message_link">
                                    <i class="bi bi-link text-warning"></i>Send Link
                                </a></li>
                                {% if features.quick_replies %}
                                <li><hr class="dropdown-divider"></li>
                                <li class="dropdown-header">ðŸ”˜ Interactive</li>
                                <li><a class="dropdown-item" href="#" data-add-node="message_quick_reply">
                                    <i class="bi bi-ui-radios-grid text-success"></i>Quick Reply
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-add-node="message_button_template">
                                    <i class="bi bi-menu-button-wide text-purple"></i>Message with Buttons
                                </a></li>
                                {% endif %}
                                {% if features.follower_check %}
                                <li><hr class="dropdown-divider"></li>
                                <li class="dropdown-header">ðŸ”€ Conditions</li>
                                <li><a class="dropdown-item" href="#" data-add-node="condition_follower" id="formAddFollowerCheck">
                                    <i class="bi bi-person-check text-danger"></i>Check if Follower
                                </a></li>
                                {% endif %}
                                <li><a class="dropdown-item" href="#" data-add-node="condition_user_interacted">
                                    <i class="bi bi-person-lines-fill" style="color: #5a2d82;"></i>Check if Returning
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li class="dropdown-header">âœ¨ Advanced</li>
                                <li><a class="dropdown-item" href="#" data-add-node="collect_data">
                                    <i class="bi bi-input-cursor-text text-orange"></i>Collect Info
                                </a></li>
                                {% if features.ai_social_agent %}
                                <li><a class="dropdown-item" href="#" data-add-node="ai_conversation">
                                    <i class="bi bi-cpu" style="color: var(--primary);"></i>AI Chat
                                </a></li>
                                {% else %}
                                <li><a class="dropdown-item disabled text-muted" href="#">
                                    <i class="bi bi-cpu"></i>AI Chat
                                    <span class="badge bg-secondary ms-2" style="font-size: 9px;">Upgrade</span>
                                </a></li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Drawflow Library (latest version) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/drawflow@0.0.60/dist/drawflow.min.css">
<script src="https://cdn.jsdelivr.net/npm/drawflow@0.0.60/dist/drawflow.min.js"></script>

<script>
const flowId = {{ flow.id }};
const csrfToken = '{{ csrf_token }}';
const existingNodes = {{ nodes_json|safe }};
const postsApiUrl = '{% url "instagram_api_posts" %}';
const wizardUrl = '{% url "flow_edit_wizard" flow.pk %}';
const hasAccountLevelAutomation = {{ features.account_level_automation|yesno:"true,false,false" }};
</script>
<script src="{% static 'js/flow_edit.js' %}?v=3"></script>

<!-- Post Selection Modal -->
<div class="modal fade" id="postSelectModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header py-2">
                <h6 class="modal-title">Select Instagram Post</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="postsLoading" class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 mb-0 small">Loading your posts...</p>
                </div>
                <div id="postsGrid" class="row g-2" style="display: none;"></div>
                <div id="postsError" class="alert alert-danger" style="display: none;"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
