{% extends 'staff/base.html' %}

{% block title %}{{ action }} Category{% endblock %}

{% block staff_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold mb-0">{{ action }} Category</h4>
    <a href="{% url 'staff_codeword_category_list' %}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i> Back
    </a>
</div>

<div class="card p-4">
    <form method="post">
        {% csrf_token %}

        <div class="row g-3">
            <div class="col-md-6">
                <label for="name" class="form-label">Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="name" name="name" value="{{ category.name|default:'' }}" required>
            </div>

            <div class="col-md-6">
                <label for="slug" class="form-label">Slug <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="slug" name="slug" value="{{ category.slug|default:'' }}" required pattern="[a-z0-9-]+">
                <small class="text-muted">URL-friendly identifier (lowercase, no spaces)</small>
            </div>

            <div class="col-md-6">
                <label for="icon" class="form-label">Icon</label>
                <input type="text" class="form-control" id="icon" name="icon" value="{{ category.icon|default:'bi-puzzle' }}">
                <small class="text-muted">Bootstrap icon class (e.g., bi-globe, bi-code-slash)</small>
            </div>

            <div class="col-md-6">
                <label for="color" class="form-label">Color</label>
                <select class="form-select" id="color" name="color">
                    <option value="text-primary" {% if category.color == 'text-primary' %}selected{% endif %}>Primary (Blue)</option>
                    <option value="text-success" {% if category.color == 'text-success' %}selected{% endif %}>Success (Green)</option>
                    <option value="text-info" {% if category.color == 'text-info' %}selected{% endif %}>Info (Cyan)</option>
                    <option value="text-warning" {% if category.color == 'text-warning' %}selected{% endif %}>Warning (Yellow)</option>
                    <option value="text-danger" {% if category.color == 'text-danger' %}selected{% endif %}>Danger (Red)</option>
                    <option value="text-secondary" {% if category.color == 'text-secondary' %}selected{% endif %}>Secondary (Gray)</option>
                    <option value="text-purple" {% if category.color == 'text-purple' %}selected{% endif %}>Purple</option>
                    <option value="text-teal" {% if category.color == 'text-teal' %}selected{% endif %}>Teal</option>
                    <option value="text-orange" {% if category.color == 'text-orange' %}selected{% endif %}>Orange</option>
                    <option value="text-muted" {% if category.color == 'text-muted' %}selected{% endif %}>Muted</option>
                </select>
            </div>

            <div class="col-md-6">
                <label for="order" class="form-label">Display Order</label>
                <input type="number" class="form-control" id="order" name="order" value="{{ category.order|default:0 }}" min="0">
                <small class="text-muted">Lower numbers appear first</small>
            </div>

            <div class="col-md-6">
                <label for="description" class="form-label">Description</label>
                <input type="text" class="form-control" id="description" name="description" value="{{ category.description|default:'' }}" maxlength="200">
            </div>

            <div class="col-12">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="is_active" name="is_active" {% if category.is_active or not category %}checked{% endif %}>
                    <label class="form-check-label" for="is_active">
                        Active (visible to players)
                    </label>
                </div>
            </div>

            <div class="col-12">
                <div class="card bg-light p-3">
                    <strong>Preview:</strong>
                    <div class="d-flex align-items-center mt-2" id="preview">
                        <i class="bi bi-puzzle text-primary me-2" id="previewIcon"></i>
                        <span id="previewName">Category Name</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-check me-1"></i> {{ action }} Category
            </button>
            <a href="{% url 'staff_codeword_category_list' %}" class="btn btn-outline-secondary ms-2">Cancel</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.getElementById('name');
    const slugInput = document.getElementById('slug');
    const iconInput = document.getElementById('icon');
    const colorSelect = document.getElementById('color');
    const previewIcon = document.getElementById('previewIcon');
    const previewName = document.getElementById('previewName');

    function updatePreview() {
        previewIcon.className = 'bi ' + iconInput.value + ' ' + colorSelect.value + ' me-2';
        previewName.textContent = nameInput.value || 'Category Name';
    }

    // Auto-generate slug from name (only if slug is empty or matches auto-generated)
    let autoSlug = true;
    nameInput.addEventListener('input', function() {
        if (autoSlug) {
            slugInput.value = nameInput.value.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
        }
        updatePreview();
    });

    slugInput.addEventListener('input', function() {
        autoSlug = false;
    });

    iconInput.addEventListener('input', updatePreview);
    colorSelect.addEventListener('change', updatePreview);

    updatePreview();
});
</script>
{% endblock %}
