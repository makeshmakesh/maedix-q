{% extends 'staff/base.html' %}

{% block title %}Code Word Words{% endblock %}

{% block staff_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold mb-0">Code Word Bank</h4>
    <div>
        <a href="{% url 'staff_codeword_import' %}" class="btn btn-outline-primary me-2">
            <i class="bi bi-upload me-1"></i> Import JSON
        </a>
        <a href="{% url 'staff_codeword_word_create' %}" class="btn btn-primary">
            <i class="bi bi-plus me-1"></i> New Word
        </a>
    </div>
</div>

<!-- Filters -->
<div class="card p-3 mb-4">
    <form method="get" class="row g-3 align-items-end">
        <div class="col-md-3">
            <label class="form-label">Category</label>
            <select name="category" class="form-select">
                <option value="">All Categories</option>
                {% for cat in categories %}
                <option value="{{ cat.slug }}" {% if current_category == cat.slug %}selected{% endif %}>{{ cat.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Difficulty</label>
            <select name="difficulty" class="form-select">
                <option value="">All Difficulties</option>
                <option value="easy" {% if current_difficulty == 'easy' %}selected{% endif %}>Easy</option>
                <option value="medium" {% if current_difficulty == 'medium' %}selected{% endif %}>Medium</option>
                <option value="hard" {% if current_difficulty == 'hard' %}selected{% endif %}>Hard</option>
            </select>
        </div>
        <div class="col-md-4">
            <label class="form-label">Search</label>
            <input type="text" name="search" class="form-control" placeholder="Search words..." value="{{ search }}">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-outline-primary w-100">
                <i class="bi bi-search me-1"></i> Filter
            </button>
        </div>
    </form>
</div>

<div class="card">
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Word</th>
                    <th>Category</th>
                    <th>Difficulty</th>
                    <th>Hint</th>
                    <th>Played</th>
                    <th>Solve Rate</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for word in words %}
                <tr>
                    <td><strong class="font-monospace">{{ word.word }}</strong></td>
                    <td>
                        {% if word.category %}
                        <span class="badge bg-light text-dark">
                            <i class="bi {{ word.category.icon }} {{ word.category.color }} me-1"></i>
                            {{ word.category.name }}
                        </span>
                        {% else %}
                        <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if word.difficulty == 'easy' %}
                        <span class="badge bg-success">Easy</span>
                        {% elif word.difficulty == 'medium' %}
                        <span class="badge bg-warning text-dark">Medium</span>
                        {% else %}
                        <span class="badge bg-danger">Hard</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if word.hint %}
                        <span class="text-truncate d-inline-block" style="max-width: 150px;" title="{{ word.hint }}">{{ word.hint }}</span>
                        {% else %}
                        <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                    <td>{{ word.times_played }}</td>
                    <td>
                        {% if word.times_played > 0 %}
                        {{ word.solve_rate }}%
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>
                        {% if word.is_active %}
                        <span class="badge bg-success">Active</span>
                        {% else %}
                        <span class="badge bg-secondary">Inactive</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <a href="{% url 'staff_codeword_word_edit' word.pk %}" class="btn btn-outline-primary">
                                <i class="bi bi-pencil"></i>
                            </a>
                            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ word.pk }}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>

                        <!-- Delete Modal -->
                        <div class="modal fade" id="deleteModal{{ word.pk }}" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Delete Word</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p>Are you sure you want to delete <strong class="font-monospace">{{ word.word }}</strong>?</p>
                                        <p class="text-muted mb-0">This word has been played {{ word.times_played }} times.</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <form action="{% url 'staff_codeword_word_delete' word.pk %}" method="post" class="d-inline">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-danger">Delete</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center py-4 text-muted">
                        No words found. <a href="{% url 'staff_codeword_word_create' %}">Add one</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="mt-3 text-muted">
    <small>Showing {{ words|length }} word{% if words|length != 1 %}s{% endif %}</small>
</div>
{% endblock %}
