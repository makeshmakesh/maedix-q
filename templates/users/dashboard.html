{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<section class="py-4 py-md-5">
    <div class="container">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
            <div class="mb-3 mb-md-0">
                <h2 class="fw-bold mb-1">Welcome back, {{ user.get_short_name }}!</h2>
                <p class="text-muted mb-0">Ready to level up your skills?</p>
            </div>
            <a href="{% url 'quiz_home' %}" class="btn btn-primary">
                <i class="bi bi-play-circle"></i> Take a Quiz
            </a>
        </div>

        <!-- Stats Cards -->
        <div class="row g-3 g-md-4 mb-4 mb-md-5">
            <div class="col-6 col-md-3">
                <div class="card p-3 p-md-4 text-center h-100">
                    <i class="bi bi-trophy-fill text-warning fs-3 fs-md-2 mb-2"></i>
                    <h3 class="fw-bold mb-0">{{ stats.xp_points }}</h3>
                    <small class="text-muted">Total XP</small>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="card p-3 p-md-4 text-center h-100">
                    <i class="bi bi-check-circle-fill text-success fs-3 fs-md-2 mb-2"></i>
                    <h3 class="fw-bold mb-0">{{ stats.total_quizzes_passed }}</h3>
                    <small class="text-muted">Quizzes Passed</small>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="card p-3 p-md-4 text-center h-100">
                    <i class="bi bi-fire text-danger fs-3 fs-md-2 mb-2"></i>
                    <h3 class="fw-bold mb-0">{{ stats.current_streak }}</h3>
                    <small class="text-muted">Day Streak</small>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="card p-3 p-md-4 text-center h-100">
                    <i class="bi bi-bullseye text-primary fs-3 fs-md-2 mb-2"></i>
                    <h3 class="fw-bold mb-0">{{ stats.accuracy }}%</h3>
                    <small class="text-muted">Accuracy</small>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <!-- Quick Actions -->
            <div class="col-lg-8">
                <div class="card p-4 mb-4">
                    <h5 class="fw-bold mb-3">Quick Actions</h5>
                    <div class="row g-3">
                        <div class="col-6 col-md-3">
                            <a href="{% url 'quiz_home' %}" class="card p-3 text-decoration-none h-100 text-center">
                                <i class="bi bi-lightning-charge text-primary fs-4"></i>
                                <small class="mt-2 d-block">Quizzes</small>
                            </a>
                        </div>
                        <div class="col-6 col-md-3">
                            <a href="{% url 'quiz_history' %}" class="card p-3 text-decoration-none h-100 text-center">
                                <i class="bi bi-clock-history text-info fs-4"></i>
                                <small class="mt-2 d-block">History</small>
                            </a>
                        </div>
                        <div class="col-6 col-md-3">
                            <a href="{% url 'leaderboard' %}" class="card p-3 text-decoration-none h-100 text-center">
                                <i class="bi bi-bar-chart text-success fs-4"></i>
                                <small class="mt-2 d-block">Leaderboard</small>
                            </a>
                        </div>
                        <div class="col-6 col-md-3">
                            <a href="{% url 'subscription' %}" class="card p-3 text-decoration-none h-100 text-center">
                                <i class="bi bi-credit-card text-warning fs-4"></i>
                                <small class="mt-2 d-block">Subscription</small>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Progress Summary -->
                <div class="card p-4 mb-4">
                    <h5 class="fw-bold mb-3">Your Progress</h5>
                    <div class="d-flex justify-content-between mb-2 pb-2 border-bottom">
                        <span class="text-muted">Quizzes Completed</span>
                        <span class="text-primary fw-bold">{{ stats.total_quizzes_taken }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2 pb-2 border-bottom">
                        <span class="text-muted">Questions Answered</span>
                        <span class="text-primary fw-bold">{{ stats.total_questions_answered }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2 pb-2 border-bottom">
                        <span class="text-muted">Correct Answers</span>
                        <span class="text-success fw-bold">{{ stats.total_correct_answers }}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Longest Streak</span>
                        <span class="text-warning fw-bold">{{ stats.longest_streak }} days</span>
                    </div>
                </div>

                <!-- Generated Videos -->
                {% if recent_videos %}
                <div class="card p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="fw-bold mb-0"><i class="bi bi-camera-reels me-2"></i>Your Videos</h5>
                    </div>
                    <div class="list-group list-group-flush">
                        {% for video in recent_videos %}
                        <div class="list-group-item px-0 d-flex justify-content-between align-items-center">
                            <div>
                                <a href="{% url 'quiz_detail' video.quiz.slug %}" class="text-decoration-none fw-medium">
                                    {{ video.quiz.title|truncatewords:5 }}
                                </a>
                                <br>
                                <small class="text-muted">{{ video.created_at|date:"M d, H:i" }} Â· {{ video.questions_count }}Q</small>
                            </div>
                            <div class="btn-group btn-group-sm">
                                <a href="{{ video.s3_url }}" class="btn btn-outline-success" target="_blank" title="Download">
                                    <i class="bi bi-download"></i>
                                </a>
                                {% if instagram_connected %}
                                <a href="{% url 'instagram_post_page' %}?video_url={{ video.s3_url|urlencode }}&title={{ video.quiz.title|urlencode }}&return_url={% url 'dashboard' %}"
                                   class="btn btn-outline-danger" title="Post to Instagram">
                                    <i class="bi bi-instagram"></i>
                                </a>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <div class="card p-4 mb-4">
                    <h5 class="fw-bold mb-3">Profile</h5>
                    <div class="text-center mb-3">
                        <i class="bi bi-person-circle text-muted" style="font-size: 4rem;"></i>
                    </div>
                    <h6 class="text-center">{{ user.get_full_name }}</h6>
                    <p class="text-muted text-center small">{{ user.email }}</p>
                    <a href="{% url 'profile' %}" class="btn btn-outline-primary btn-sm w-100">View Profile</a>
                </div>

                <div class="card p-4">
                    <h5 class="fw-bold mb-3">Daily Goal</h5>
                    <p class="text-muted small">Complete 1 quiz today to maintain your streak!</p>
                    <div class="progress" style="height: 10px;">
                        <div class="progress-bar bg-primary" style="width: {% if stats.last_quiz_date == today %}100{% else %}0{% endif %}%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}
